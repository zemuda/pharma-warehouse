# bronze_loader_config.yaml
# Enhanced Bronze Layer Configuration

# ==============================================================================
# PATHS CONFIGURATION
# ==============================================================================
paths:
  bronze_base_path: "C:/pharma_warehouse/excel_etl_pipeline/bronze_layer/bronze_data/bronze"
  source_data_path: "C:/pharma_warehouse/excel_etl_pipeline/raw_layer/raw_data/output"
  log_directory: "C:/pharma_warehouse/excel_etl_pipeline/bronze_layer/bronze_data/logs"
  checkpoint_directory: "C:/pharma_warehouse/excel_etl_pipeline/bronze_layer/bronze_data/checkpoints"

# ==============================================================================
# POSTGRESQL CONFIGURATION
# ==============================================================================
postgresql:
  host: "localhost"
  port: 5432
  database: "pharma_warehouse"
  user: "postgres"
  password: "1234"
  schema: "bronze_layer"
  connection_pool_size: 5
  connection_timeout: 30

# ==============================================================================
# DATA SOURCES CONFIGURATION
# ==============================================================================
data_sources:
  features:
    - name: "sales"
      enabled: true
      subfeatures:
        - name: "cash_invoices"
          enabled: true
          data_types:
            - name: "detailed"
              enabled: true
              path: "sales/cash_invoices/detailed"
              primary_keys: ["DOCUMENT_NUMBER", "CUS_CODE", "ITEM_CODE"]
              # expected_files: 5
              # expected_min_rows: 300000
            - name: "summarized" 
              enabled: true
              path: "sales/cash_invoices/summarized"
              primary_keys: ["DOCUMENT_NUMBER"]
              # expected_files: 3
              # expected_min_rows: 1000

    # NEW: Master Data Feature
    - name: "master_data"
      enabled: true
      subfeatures:
        - name: "customer_accounts"
          enabled: true
          data_types:
            - name: "all_branches"
              enabled: true
              path: "master_data/customer_accounts/all_branches"
              primary_keys: ["CORP_CODE"]

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================
features:
  enable_scd2: true
  enable_quality_columns: true
  enable_validation: false
  enable_incremental_loading: true
  enable_schema_evolution: true
  enable_cross_validation: true

# ==============================================================================
# VALIDATION RULES
# ==============================================================================
validation_rules:
  global:
    - rule_type: "null_check"
      columns: ["_source_file_path", "_source_file_name"]  # âœ… These exist in all datasets
      max_null_percentage: 0.0  # Should never be null
      # columns: ["DOCUMENT_NUMBER", "TRN_DATE", "AMOUNT"]
      # max_null_percentage: 5.0
      severity: "error"
    - rule_type: "range_check"
      columns: ["AMOUNT"]
      min_value: 0
      severity: "warning"

  # NEW: Master Data specific validation rules
  master_data:
    customer_accounts:
      - rule_type: "null_check"
        columns: ["CORP_CODE", "CORP__NAME", "CORP_TYPE"]
        max_null_percentage: 1.0
        severity: "error"
      - rule_type: "format_check"
        columns: ["CORP_CODE"]
        pattern: "^CUS[0-9A-Z-]+$"
        severity: "warning"
      - rule_type: "domain_check"
        columns: ["CORP_TYPE"]
        allowed_values: ["PHARMACY", "HOSPITALS", "CLINIC", "OTHER"]
        severity: "warning"
      - rule_type: "domain_check"
        columns: ["BLOCKED"]
        allowed_values: ["Y", "N"]
        severity: "warning"
      - rule_type: "domain_check"
        columns: ["CSALE_CUS"]
        allowed_values: ["YES", "NO"]
        severity: "warning"

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file:
    enabled: true
    filename: "bronze_loader_enhanced.log"
    max_bytes: 10485760
    backup_count: 5